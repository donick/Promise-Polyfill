/*!
 * @overview PromisePolyfill JavaScript Library
 *
 * @copyright Donick Li
 * @author Donick Li <donick.li@gmail.com>
 * @license Released under the MIT license
 * https://github.com/donick/PromisePolyfill
 * @version v1.1.1
 * Date: 2016-06-23T21:23Z
 */
(function(){"use strict";function n(n,t){return n.hasOwnProperty(t)}function t(n){return"string"==typeof n}function i(n){return"function"==typeof n}function e(n){return/(String|Array)/.test(Object.prototype.toString.call(n))}function o(n){return n&&"function"==typeof n.then}function u(){var n=b.Promise;return i(n)&&(""+n).indexOf("[native code]")?!0:!1}function r(){return"promise-"+N++}function f(i){return t(i)?(n(A,i)||(A[i]={}),A[i]):i instanceof s?A[i.id]:void 0}function c(t,i){function e(t){return n(i,t)?i[t]:o[t]}var o=f(t);o.id=t,o.status=e("status"),o.value=e("value"),o.next=e("next")}function s(n){function t(n){var t=o.id,i=f(t);i.status===w[0]&&(c(t,{status:w[1],value:n}),a(t))}function e(n){var t=o.id,i=f(t),e=i.next.length;if(i.status===w[0]){if(c(t,{status:w[2],value:n}),!e)throw n;a(t)}}if(!(this instanceof s))throw j.isNotInstance;if(!i(n))throw j.isNotFunction;var o=this,u=this.id=r();c(u,{status:w[0],value:void 0,next:[]}),setTimeout(function(){var i=f(o),u=i.next.length;try{n(t,e)}catch(r){if(i.status===w[1])return;if(!u)throw"(in promise) "+r;e(r)}},0)}function a(n){for(var t=f(n).next;t.length;)setTimeout(t.shift(),0)}function v(n){return new s(function(t,i){n(t,i)})}function l(n,i){function e(n,t,e){if(c[t]=e,n){if(--f)return;i(!0,c)}else{if(a)return;a=!0,i(!1,e)}}var u,r=n.length,f=r,c=[],a=!1;if(t(n))i(!0,n.split(""));else for(var v=0;r>v&&!a;v++)u=n[v],o(u)?u.then(function(n){return function(t){e(!0,n,t)}}(v),function(n){return function(t){e(!1,n,t)}}(v)):s.resolve({i:v,item:u}).then(function(n){e(!0,n.i,n.item)})}function d(n){var t;if(e(n))return l(n,function(n,i){return t?void t(n,i):void(t=function(t,e){n?t(i):e(i)})}),v(function(n,i){return t?void t(n,i):void(t=function(t,e){t?n(e):i(e)})})}function h(n,i){function e(n,t){f||(f=!0,n?i(!0,t):i(!1,t))}var u,r=n.length,f=!1;if(t(n))i(!0,n.charAt(0));else for(var c=0;r>c&&!f;c++)u=n[c],o(u)?u.then(function(n){e(!0,n)},function(n){e(!1,n)}):s.resolve(u).then(function(n){e(!0,n)})}function p(n){var t;if(e(n))return h(n,function(n,i){return t?void t(n,i):void(t=function(t,e){n?t(i):e(i)})}),v(function(n,i){return t?void t(n,i):void(t=function(t,e){t?n(e):i(e)})})}function m(n){return v(function(t){t(n)})}function y(n){return v(function(t,i){i(n)})}function x(n,t){function e(u,r){var s=f(o),a=s.status,v=s.value;if(a===w[0])return void(c=function(){e(u,r)});if(a===w[1])if(i(n))try{v=n(v),P(v,u,r)}catch(l){r(l)}else u(v);else if(a===w[2])if(i(t))try{v=t(v),P(v,u,r)}catch(l){r(l)}else r(v)}var o=this,u=f(o),r=u.status,c=function(){};return r===w[0]&&u.next.push(function(){c()}),v(e)}function g(n){function t(o,u){var c=f(e),s=c.status,a=c.value;if(s===w[0])return void(r=function(){t(o,u)});if(s===w[2])if(i(n))try{a=n(a),P(a,o,u)}catch(v){u(v)}else u(a)}var e=this,o=f(e),u=o.status,r=function(){};return u===w[0]&&o.next.push(function(){r()}),v(t)}function P(n,t,i){o(n)?n.then(function(n){t(n)},function(n){i(n)}):t(n)}var w=["pending","resolved","rejected"],j={isNotInstance:"undefined is not a promise",isNotFunction:"Promise resolver undefined is not a function"},N=0,b=this,O="PromisePolyfill",A={};s.all=d,s.race=p,s.reject=y,s.resolve=m,s.$info=function(n,t){if(o(n)){var i=f(n.id),e=t?i[t]:i;return e}},s.prototype={constructor:s,then:x,"catch":g},b&&(b[O]=function(n){if(n){if(u())return b.Promise;b.Promise=s}return s}),"function"==typeof define&&define.amd&&define(O,[],function(){return s}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=s)}).call(this);
