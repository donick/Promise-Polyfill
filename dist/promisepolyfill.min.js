/*!
 * @overview PromisePolyfill JavaScript Library
 *
 * @copyright Donick Li
 * @author Donick Li <donick.li@gmail.com>
 * @license Released under the MIT license
 * https://github.com/donick/PromisePolyfill
 * @version v1.0.0
 * Date: 2016-06-09T18:02Z
 */
(function(){"use strict";function t(t,n){return t.hasOwnProperty(n)}function n(t){return"string"==typeof t}function i(t){return"function"==typeof t}function e(t){return/(String|Array)/.test(Object.prototype.toString.call(t))}function o(t){return t&&"function"==typeof t.then}function r(){var t=w.Promise;return i(t)&&(""+t).indexOf("[native code]")?!0:!1}function u(){return"promise-"+P++}function c(i){return n(i)?(t(N,i)||(N[i]={}),N[i]):i instanceof s?N[i.id]:void 0}function f(n,i){function e(n){return t(i,n)?i[n]:o[n]}var o=c(n);o.id=n,o.status=e("status"),o.value=e("value"),o.next=e("next")}function s(t){function n(t){var n=o.id,i=c(n);i.status===g[0]&&(f(n,{status:g[1],value:t}),a(n))}function e(t){var n=o.id,i=c(n),e=i.next.length;if(i.status===g[0]){if(f(n,{status:g[2],value:t}),!e)throw t;a(n)}}if(!(this instanceof s))throw k.isNotInstance;if(!i(t))throw k.isNotFunction;var o=this,r=this.id=u();f(r,{status:g[0],value:void 0,next:[]}),setTimeout(function(){var i=c(o),r=i.next.length;try{t(n,e)}catch(u){if(i.status===g[1])return;if(!r)throw"(in promise) "+u;e(u)}},0)}function a(t){for(var n=c(t).next;n.length;)setTimeout(n.shift(),0)}function l(t){var n=new s(function(i,e){n.callback=function(){t(i,e)},t(i,e)});return n}function v(t,i){function e(t,n,e){if(f[n]=e,t){if(--c)return;i(!0,f)}else{if(a)return;a=!0,i(!1,e)}}var r,u=t.length,c=u,f=[],a=!1;if(n(t))i(!0,t.split(""));else for(var l=0;u>l&&!a;l++)r=t[l],o(r)?r.then(function(t){return function(n){e(!0,t,n)}}(l),function(t){return function(n){e(!1,t,n)}}(l)):s.resolve({i:l,item:r}).then(function(t){e(!0,t.i,t.item)})}function d(t){var n;if(e(t))return v(t,function(t,i){return n?void n(t,i):void(n=function(n,e){t?n(i):e(i)})}),l(function(t,i){return n?void n(t,i):void(n=function(n,e){n?t(e):i(e)})})}function h(t,i){function e(t,n){c||(c=!0,t?i(!0,n):i(!1,n))}var r,u=t.length,c=!1;if(n(t))i(!0,t.charAt(0));else for(var f=0;u>f&&!c;f++)r=t[f],o(r)?r.then(function(t){e(!0,t)},function(t){e(!1,t)}):s.resolve(r).then(function(t){e(!0,t)})}function p(t){var n;if(e(t))return h(t,function(t,i){return n?void n(t,i):void(n=function(n,e){t?n(i):e(i)})}),l(function(t,i){return n?void n(t,i):void(n=function(n,e){n?t(e):i(e)})})}function m(t){return l(function(n){n(t)})}function y(t){return l(function(n,i){i(t)})}function x(t,n){var e,o=this,r=c(o),u=r.status;return u===g[0]&&r.next.push(function(){e.callback&&e.callback()}),e=l(function(r,u){var f=c(o),s=f.status,a=f.value;if(s!==g[0]&&delete e.callback,s===g[1]){if(i(t))try{r(t(a))}catch(l){return void u(l)}r(a)}else if(s===g[2])if(i(n))try{r(n(a))}catch(l){u(l)}else u(a)})}function b(t){var n,e=this,o=c(e),r=o.status;return r===g[0]&&o.next.push(function(){n.callback&&n.callback()}),n=l(function(o,r){var u=c(e),f=u.status,s=u.value;if(f!==g[0]&&delete n.callback,f===g[2])if(i(t))try{o(t(s))}catch(a){r(a)}else r(s)})}var g=["pending","resolved","rejected"],k={isNotInstance:"undefined is not a promise",isNotFunction:"Promise resolver undefined is not a function"},P=0,w=this,j="PromisePolyfill",N={};s.all=d,s.race=p,s.reject=y,s.resolve=m,s.$info=function(t,n){if(o(t)){var i=c(t.id),e=n?i[n]:i;return e}},s.prototype={constructor:s,then:x,"catch":b},w&&(w[j]=function(t){if(t){if(r())return w.Promise;w.Promise=s}return s}),"function"==typeof define&&define.amd&&define(j,[],function(){return s}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=s)}).call(this);
