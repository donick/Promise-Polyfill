/*!
 * @overview PromisePolyfill JavaScript Library
 *
 * @copyright Donick Li
 * @author Donick Li <donick.li@gmail.com>
 * @license Released under the MIT license
 * https://github.com/donick/PromisePolyfill
 * @version v1.1.0
 * Date: 2016-06-21T11:20Z
 */
(function(){"use strict";function n(n,t){return n.hasOwnProperty(t)}function t(n){return"string"==typeof n}function i(n){return"function"==typeof n}function e(n){return/(String|Array)/.test(Object.prototype.toString.call(n))}function o(n){return n&&"function"==typeof n.then}function r(){var n=b.Promise;return i(n)&&(""+n).indexOf("[native code]")?!0:!1}function u(){return"promise-"+N++}function f(i){return t(i)?(n(A,i)||(A[i]={}),A[i]):i instanceof s?A[i.id]:void 0}function c(t,i){function e(t){return n(i,t)?i[t]:o[t]}var o=f(t);o.id=t,o.status=e("status"),o.value=e("value"),o.next=e("next")}function s(n){function t(n){var t=o.id,i=f(t);i.status===w[0]&&(c(t,{status:w[1],value:n}),a(t))}function e(n){var t=o.id,i=f(t),e=i.next.length;if(i.status===w[0]){if(c(t,{status:w[2],value:n}),!e)throw n;a(t)}}if(!(this instanceof s))throw j.isNotInstance;if(!i(n))throw j.isNotFunction;var o=this,r=this.id=u();c(r,{status:w[0],value:void 0,next:[]}),setTimeout(function(){var i=f(o),r=i.next.length;try{n(t,e)}catch(u){if(i.status===w[1])return;if(!r)throw"(in promise) "+u;e(u)}},0)}function a(n){for(var t=f(n).next;t.length;)setTimeout(t.shift(),0)}function v(n){return new s(function(t,i){n(t,i)})}function d(n,i){function e(n,t,e){if(c[t]=e,n){if(--f)return;i(!0,c)}else{if(a)return;a=!0,i(!1,e)}}var r,u=n.length,f=u,c=[],a=!1;if(t(n))i(!0,n.split(""));else for(var v=0;u>v&&!a;v++)r=n[v],o(r)?r.then(function(n){return function(t){e(!0,n,t)}}(v),function(n){return function(t){e(!1,n,t)}}(v)):s.resolve({i:v,item:r}).then(function(n){e(!0,n.i,n.item)})}function l(n){var t;if(e(n))return d(n,function(n,i){return t?void t(n,i):void(t=function(t,e){n?t(i):e(i)})}),v(function(n,i){return t?void t(n,i):void(t=function(t,e){t?n(e):i(e)})})}function h(n,i){function e(n,t){f||(f=!0,n?i(!0,t):i(!1,t))}var r,u=n.length,f=!1;if(t(n))i(!0,n.charAt(0));else for(var c=0;u>c&&!f;c++)r=n[c],o(r)?r.then(function(n){e(!0,n)},function(n){e(!1,n)}):s.resolve(r).then(function(n){e(!0,n)})}function p(n){var t;if(e(n))return h(n,function(n,i){return t?void t(n,i):void(t=function(t,e){n?t(i):e(i)})}),v(function(n,i){return t?void t(n,i):void(t=function(t,e){t?n(e):i(e)})})}function m(n){return v(function(t){t(n)})}function y(n){return v(function(t,i){i(n)})}function x(n,t){function e(u,c){var a=f(r),v=a.status,d=a.value;if(o(d))return void d.then(n,t);if(v===w[0])return void(s=function(){e(u,c)});if(v===w[1])if(i(n))try{d=n(d),P(d,u,c)}catch(l){return void c(l)}else u(d);else if(v===w[2])if(i(t))try{d=t(d),P(d,u,c)}catch(l){c(l)}else c(d)}var r=this,u=f(r),c=u.status,s=function(){};return c===w[0]&&u.next.push(function(){s()}),v(e)}function g(n){function t(r,u){var s=f(e),a=s.status,v=s.value;if(o(v))return void v.catch(n);if(a===w[0])return void(c=function(){t(r,u)});if(a===w[2])if(i(n))try{v=n(v),P(v,r,u)}catch(d){u(d)}else u(v)}var e=this,r=f(e),u=r.status,c=function(){};return u===w[0]&&r.next.push(function(){c()}),v(t)}function P(n,t,i){o(n)?n.then(function(n){t(n)},function(n){i(n)}):t(n)}var w=["pending","resolved","rejected"],j={isNotInstance:"undefined is not a promise",isNotFunction:"Promise resolver undefined is not a function"},N=0,b=this,O="PromisePolyfill",A={};s.all=l,s.race=p,s.reject=y,s.resolve=m,s.$info=function(n,t){if(o(n)){var i=f(n.id),e=t?i[t]:i;return e}},s.prototype={constructor:s,then:x,"catch":g},b&&(b[O]=function(n){if(n){if(r())return b.Promise;b.Promise=s}return s}),"function"==typeof define&&define.amd&&define(O,[],function(){return s}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=s)}).call(this);
