/*!
 * @overview PromisePolyfill JavaScript Library
 *
 * @copyright Donick Li
 * @author Donick Li <donick.li@gmail.com>
 * @license Released under the MIT license
 * https://github.com/donick/PromisePolyfill
 * @version v1.0.1
 * Date: 2016-06-17T23:44Z
 */
(function(){"use strict";function n(n,t){return n.hasOwnProperty(t)}function t(n){return"string"==typeof n}function i(n){return"function"==typeof n}function e(n){return/(String|Array)/.test(Object.prototype.toString.call(n))}function o(n){return n&&"function"==typeof n.then}function r(){var n=N.Promise;return i(n)&&(""+n).indexOf("[native code]")?!0:!1}function u(){return"promise-"+j++}function f(i){return t(i)?(n(O,i)||(O[i]={}),O[i]):i instanceof s?O[i.id]:void 0}function c(t,i){function e(t){return n(i,t)?i[t]:o[t]}var o=f(t);o.id=t,o.status=e("status"),o.value=e("value"),o.next=e("next")}function s(n){function t(n){var t=o.id,i=f(t);i.status===P[0]&&(c(t,{status:P[1],value:n}),a(t))}function e(n){var t=o.id,i=f(t),e=i.next.length;if(i.status===P[0]){if(c(t,{status:P[2],value:n}),!e)throw n;a(t)}}if(!(this instanceof s))throw w.isNotInstance;if(!i(n))throw w.isNotFunction;var o=this,r=this.id=u();c(r,{status:P[0],value:void 0,next:[]}),setTimeout(function(){var i=f(o),r=i.next.length;try{n(t,e)}catch(u){if(i.status===P[1])return;if(!r)throw"(in promise) "+u;e(u)}},0)}function a(n){for(var t=f(n).next;t.length;)setTimeout(t.shift(),0)}function v(n){return new s(function(t,i){n(t,i)})}function l(n,i){function e(n,t,e){if(c[t]=e,n){if(--f)return;i(!0,c)}else{if(a)return;a=!0,i(!1,e)}}var r,u=n.length,f=u,c=[],a=!1;if(t(n))i(!0,n.split(""));else for(var v=0;u>v&&!a;v++)r=n[v],o(r)?r.then(function(n){return function(t){e(!0,n,t)}}(v),function(n){return function(t){e(!1,n,t)}}(v)):s.resolve({i:v,item:r}).then(function(n){e(!0,n.i,n.item)})}function d(n){var t;if(e(n))return l(n,function(n,i){return t?void t(n,i):void(t=function(t,e){n?t(i):e(i)})}),v(function(n,i){return t?void t(n,i):void(t=function(t,e){t?n(e):i(e)})})}function h(n,i){function e(n,t){f||(f=!0,n?i(!0,t):i(!1,t))}var r,u=n.length,f=!1;if(t(n))i(!0,n.charAt(0));else for(var c=0;u>c&&!f;c++)r=n[c],o(r)?r.then(function(n){e(!0,n)},function(n){e(!1,n)}):s.resolve(r).then(function(n){e(!0,n)})}function p(n){var t;if(e(n))return h(n,function(n,i){return t?void t(n,i):void(t=function(t,e){n?t(i):e(i)})}),v(function(n,i){return t?void t(n,i):void(t=function(t,e){t?n(e):i(e)})})}function m(n){return v(function(t){t(n)})}function y(n){return v(function(t,i){i(n)})}function x(n,t){function e(r,u){var s=f(o),a=s.status,v=s.value;if(a===P[0])return void(c=function(){e(r,u)});if(a===P[1]){if(i(n))try{r(n(v))}catch(l){return void u(l)}r(v)}else if(a===P[2])if(i(t))try{r(t(v))}catch(l){u(l)}else u(v)}var o=this,r=f(o),u=r.status,c=function(){};return u===P[0]&&r.next.push(function(){c()}),v(e)}function g(n){function t(o,r){var c=f(e),s=c.status,a=c.value;if(s===P[0])return void(u=function(){t(o,r)});if(s===P[2])if(i(n))try{o(n(a))}catch(v){r(v)}else r(a)}var e=this,o=f(e),r=o.status,u=function(){};return r===P[0]&&o.next.push(function(){u()}),v(t)}var P=["pending","resolved","rejected"],w={isNotInstance:"undefined is not a promise",isNotFunction:"Promise resolver undefined is not a function"},j=0,N=this,b="PromisePolyfill",O={};s.all=d,s.race=p,s.reject=y,s.resolve=m,s.$info=function(n,t){if(o(n)){var i=f(n.id),e=t?i[t]:i;return e}},s.prototype={constructor:s,then:x,"catch":g},N&&(N[b]=function(n){if(n){if(r())return N.Promise;N.Promise=s}return s}),"function"==typeof define&&define.amd&&define(b,[],function(){return s}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=s)}).call(this);
