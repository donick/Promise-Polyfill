/*!
 * @overview PromisePolyfill JavaScript Library
 *
 * @copyright Donick Li
 * @author Donick Li <donick.li@gmail.com>
 * @license Released under the MIT license
 * https://github.com/donick/PromisePolyfill
 * @version v1.0.0
 * Date: 2016-06-09T18:02Z
 */
(function(){"use strict";function t(t,n){return t.hasOwnProperty(n)}function n(t){return"string"==typeof t}function i(t){return"function"==typeof t}function e(t){return/(String|Array)/.test(Object.prototype.toString.call(t))}function o(t){return t&&"function"==typeof t.then}function u(){return"promise-"+k++}function r(i){return n(i)?(t(P,i)||(P[i]={}),P[i]):i instanceof f?P[i.id]:void 0}function c(n,i){function e(n){return t(i,n)?i[n]:o[n]}var o=r(n);o.id=n,o.status=e("status"),o.value=e("value"),o.next=e("next")}function f(t){function n(t){var n=o.id,i=r(n);i.status===x[0]&&(c(n,{status:x[1],value:t}),s(n))}function e(t){var n=o.id,i=r(n),e=i.next.length;if(i.status===x[0]){if(c(n,{status:x[2],value:t}),!e)throw t;s(n)}}if(!(this instanceof f))throw g.isNotInstance;if(!i(t))throw g.isNotFunction;var o=this,a=this.id=u();c(a,{status:x[0],value:void 0,next:[]}),setTimeout(function(){var i=r(o),u=i.next.length;try{t(n,e)}catch(c){if(i.status===x[1])return;if(!u)throw"(in promise) "+c;e(c)}},0)}function s(t){for(var n=r(t).next;n.length;)setTimeout(n.shift(),0)}function a(t){var n=new f(function(i,e){n.callback=function(){t(i,e)},t(i,e)});return n}function l(t,i){function e(t,n,e){if(s[n]=e,t){if(--c)return;i(!0,s)}else{if(a)return;a=!0,i(!1,e)}}var u,r=t.length,c=r,s=[],a=!1;if(n(t))i(!0,t.split(""));else for(var l=0;r>l&&!a;l++)u=t[l],o(u)?u.then(function(t){return function(n){e(!0,t,n)}}(l),function(t){return function(n){e(!1,t,n)}}(l)):f.resolve({i:l,item:u}).then(function(t){e(!0,t.i,t.item)})}function v(t){var n;if(e(t))return l(t,function(t,i){return n?void n(t,i):void(n=function(n,e){t?n(i):e(i)})}),a(function(t,i){return n?void n(t,i):void(n=function(n,e){n?t(e):i(e)})})}function d(t,i){function e(t,n){c||(c=!0,t?i(!0,n):i(!1,n))}var u,r=t.length,c=!1;if(n(t))i(!0,t.charAt(0));else for(var s=0;r>s&&!c;s++)u=t[s],o(u)?u.then(function(t){e(!0,t)},function(t){e(!1,t)}):f.resolve(u).then(function(t){e(!0,t)})}function h(t){var n;if(e(t))return d(t,function(t,i){return n?void n(t,i):void(n=function(n,e){t?n(i):e(i)})}),a(function(t,i){return n?void n(t,i):void(n=function(n,e){n?t(e):i(e)})})}function p(t){return a(function(n){n(t)})}function y(t){return a(function(n,i){i(t)})}function m(t,n){var e,o=this,u=r(o),c=u.status;return c===x[0]&&u.next.push(function(){e.callback&&e.callback()}),e=a(function(u,c){var f=r(o),s=f.status,a=f.value;if(s!==x[0]&&delete e.callback,s===x[1]){if(i(t))try{u(t(a))}catch(l){return void c(l)}u(a)}else if(s===x[2])if(i(n))try{u(n(a))}catch(l){c(l)}else c(a)})}function b(t){var n,e=this,o=r(e),u=o.status;return u===x[0]&&o.next.push(function(){n.callback&&n.callback()}),n=a(function(o,u){var c=r(e),f=c.status,s=c.value;if(f!==x[0]&&delete n.callback,f===x[2])if(i(t))try{o(t(s))}catch(a){u(a)}else u(s)})}var x=["pending","resolved","rejected"],g={isNotInstance:"undefined is not a promise",isNotFunction:"Promise resolver undefined is not a function"},k=0,w=this,j="PromisePolyfill",P={};f.all=v,f.race=h,f.reject=y,f.resolve=p,f.$info=function(t,n){if(o(t)){var i=r(t.id),e=n?i[n]:i;return e}},f.prototype={constructor:f,then:m,"catch":b},w&&(w[j]=function(t){return t&&(w.Promise=f),f}),"function"==typeof define&&define.amd&&define(j,[],function(){return f}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=f)}).call(this);
